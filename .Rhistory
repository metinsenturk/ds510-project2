lgm_model = glm(f_1, data = data_train, family = binomial)
summary(lgm_model)
# Anova
anova(lgm_model)
lgm_model = glm(f_0, data = data_train, family = binomial)
summary(lgm_model)
# Anova
anova(lgm_model)
# stepAIC
steps <- stepAIC(lgm_model, trace = T)
steps <- step(lgm_model)
summary(steps)
# leaps
regsubs <- regsubsets(AHD ~ Age + RestBP + Chol + MaxHR + Oldpeak,
data = data_train,
nbest = 1,
method = "exhaustive")
library(boot)
cv_model <- cv.glm(data_train, lgm_model)
cv_model$delta
cv_model <- cv.glm(data_train, lgm_model, K = 10)
cv_model$delta
flds <- createFolds(data_train, k = 200, list = TRUE, returnTrain = FALSE)
flds
#kfold
trcontrol <- trainControl(method = "cv", number = 10)
trcontrol
train(f.all, data_train, method = 'glm', family = binomial, trcontrol = trcontrol)
# packages
pkgs <- c("dplyr", "popbio")
package.check(pkgs)
# evaluation of model according to cutoff value ====
probs <- predict(lgm_model, data_train, type = "response")
#another graph
logi.hist.plot(probs, data_train$AHD, boxp = F, type = "count", col = "gray", xlabel = "Age")
logi.hist.plot(probs,
data_train$AHD,
boxp = T,
type = "count",
col = "gray",
xlabel = "Age")
logi.hist.plot(probs,
data_train$AHD,
boxp = F,
type = "count",
col = "gray",
xlabel = "Age")
# evaluation of model according to cutoff value ====
probs <- predict(lgm_model, data_train, type = "response")
head(probs)
hist(probs)
lines(density(probs))
hist(probs, prob =T)
hist(probs, prob = T)
lines(density(probs))
lines(density(probs), col = R)
lines(density(probs), col = "Red")
rocplot(probs, data_train$AHD)
cutoff_acc(probs, data_train$AHD)
cutoff_roc(probs, data_train$AHD)
source("Scripts/glm_functions.R")
rocplot(probs, data_train$AHD)
hist(preds, prob = T, main="Predicted Probability Hist")
#
cutoff_acc(probs, data_train$AHD)
rocplot(probs, data_train$AHD)
cutoff_acc(probs, data_train$AHD)[2,1]
unname(cutoff_acc(probs, data_train$AHD)[2,1])
# conf matrix test
db <- unname(cutoff_acc(probs, data_train$AHD)[2,1])
p_tr_probs = predict(lgm_model, data_train, type = "response")
head(p_tr_probs)
head(data_train)
cfi_tr <- confmatrix(p_tr_probs, data_train$AHD, db)
cfi_tr$mtrx
cfi_tr$info
source("Scripts/glm_functions.R")
# conf matrix test
db <- unname(cutoff_acc(probs, data_train$AHD)[2,1])
p_tr_probs = predict(lgm_model, data_train, type = "response")
head(p_tr_probs)
head(data_train)
cfi_tr <- confmatrix(p_tr_probs, data_train$AHD, db)
cfi_tr$mtrx
cfi_tr$info
p_te_probs = predict(lgm_model, data_test, type = "response")
head(p_te_probs)
head(data_train)
cfi_te <- confmatrix(p_te_probs, data_test$AHD, db)
cfi_te$mtrx
cfi_te$info
data_raw %>%
select(-one_of(c("X"))) %>%
select_if(is.numeric)  %>%
head
data_raw %>%
select(-one_of(c("X"))) %>%
select_if(is.numeric)  %>%
head
# odds ratio
cbind(exp(confint(lgm_model)), Ods_Ratio = exp(coef(lgm_model)), Coef = coef(lgm_model))
lgm_model %>%
exp
sapply(lgm_model exp)
sapply(lgm_model, exp)
sapply(list(lgm_model), exp)
sapply(list(lgm_model), coef)
sapply(list(lgm_model), funs(coef, confint))
sapply(list(lgm_model), funs("coef", "confint"))
sapply(list(lgm_model), funs(c("coef", "confint")))
sapply(lgm_model, funs(c("coef", "confint")))
sapply(lgm_model, confint)
sapply(list(lgm_model), confint)
sapply(list(lgm_model), confint)
sapply(list(lgm_model, lgm_model), confint)
f_9 <- AHD ~ . -X
lgm_model = glm(f_0, data = data_train, family = binomial)
summary(lgm_model)
# odds ratio
cbind(exp(confint(lgm_model)), Ods_Ratio = exp(coef(lgm_model)), Coef = coef(lgm_model))
sapply(list(lgm_model, lgm_model), confint)
# odds ratio
cbind(exp(confint(lgm_model)), Ods_Ratio = exp(coef(lgm_model)), Coef = coef(lgm_model))
# odds of variables in the model
cbind(exp(confint(lgm_model)),
Ods_Ratio = exp(coef(lgm_model)),
Coef = coef(lgm_model))
# odds of variables in the model
cbind(exp(confint(lgm_model)),
Ods_Ratio = exp(coef(lgm_model)),
Coefficients = coef(lgm_model))
# odds of variables in the model
cbind(exp(confint(lgm_model)),
'Ods Ratio' = exp(coef(lgm_model)),
Coefficients = coef(lgm_model))
# odds of variables in the model
cbind(exp(confint(lgm_model)),
'Odds Ratio' = exp(coef(lgm_model)),
Coefficients = coef(lgm_model))
# odds of variables in the model
cbind(exp(confint(lgm_model)),
Coefficients = coef(lgm_model),
'Odds Ratio' = exp(coef(lgm_model)))
# odds of variables in the model
sapply(cbind(exp(confint(lgm_model)),
Coefficients = coef(lgm_model),
'Odds Ratio' = exp(coef(lgm_model))), round, 2)
# odds of variables in the model
lapply(cbind(exp(confint(lgm_model)),
Coefficients = coef(lgm_model),
'Odds Ratio' = exp(coef(lgm_model))), round, 2)
# odds of variables in the model
mapply(cbind(exp(confint(lgm_model)),
Coefficients = coef(lgm_model),
'Odds Ratio' = exp(coef(lgm_model))), round, 2)
# odds of variables in the model
ort <- cbind(exp(confint(lgm_model)),
Coefficients = coef(lgm_model),
'Odds Ratio' = exp(coef(lgm_model)))
round(ort, 2)
# chances
data.frame('assuming all have disease' = t[1,2] / sum(t),
'assuming none hav disease' = t[1,1] / sum(t))
```{r odds ratio, include=c(-1)}
library(MASS)
library(dplyr)
library(popbio)
library(aod)
library(caret)
library(leaps)
library(bestglm)
library(boot)
# importing dataset
data_raw = read.csv("./Dataset/Heart.csv")
# assigning 0 and 1 to predictor
data_raw$AHD = ifelse(data_raw$AHD == "Yes", 1, 0)
# variables needs to be converted to factor <- Sex, Fbs, RestECG, ExAng, Ca, Slope
data_raw$Sex = as.factor(data_raw$Sex)
data_raw$Fbs = as.factor(data_raw$Fbs)
data_raw$RestECG = as.factor(data_raw$RestECG)
data_raw$ExAng = as.factor(data_raw$ExAng)
data_raw$Ca = as.factor(data_raw$Ca)
data_raw$Slope = as.factor(data_raw$Slope)
# Thal has 2 missing values: replacing with most frequent level: normal
data_raw$Thal[is.na(data_raw$Thal)] = levels(data_raw$Thal)[2]
# Ca has 4 missing values: replacing with most frequent level: 0
data_raw$Ca[is.na(data_raw$Ca)] = levels(data_raw$Ca)[1]
# normalization
data_raw %>%
select(-one_of(c("X"))) %>%
select_if(is.numeric)  %>%
head
# normalization
data_raw %>%
select(-one_of(c("X"))) %>%
select_if(is.numeric)  %>%
head
# continuous variables
cont_list = list(
Age = data_raw$Age,
RestBP = data_raw$RestBP,
Chol = data_raw$Chol,
MaxHR = data_raw$MaxHR,
Oldpeak = data_raw$Oldpeak
)
data_raw[, names(cont_list)] <- data.frame(sapply(cont_list, scale))
data_raw$RestBP = outlier_handler(data_raw$RestBP)
data_raw$Chol = outlier_handler(data_raw$Chol)
# required pckgs and fnctns ====
# local sources
source("Scripts/utility_functions.R")
source("Scripts/model_functions.R")
data_raw$RestBP = outlier_handler(data_raw$RestBP)
data_raw$Chol = outlier_handler(data_raw$Chol)
data_raw$Oldpeak = outlier_handler(data_raw$Oldpeak)
# train and test datasets
data_train = data_raw[ 1:250, ]
data_test = data_raw[251:303, ]
# variable analysis ====
#some ratios
#overall healthy rate
sum(data_train$AHD[data_train$AHD == 1]) / length(data_train$AHD)
# correlation of cont variables
cor(data.frame(cont_list))
cor(data_raw$AHD, data.frame(cont_list))
# Models ====
# logistic regression model
f_0 <- AHD ~ Age + RestBP + Chol + MaxHR + Oldpeak
lgm_model = glm(f_0, data = data_train, family = binomial)
summary(lgm_model)
f_2 <- AHD ~ Chol + MaxHR + Oldpeak
lgm_model = glm(f_3, data = data_train, family = binomial)
f_3 <- AHD ~ Chol + MaxHR + Oldpeak
lgm_model = glm(f_3, data = data_train, family = binomial)
summary(lgm_model)
# Anova
anova(lgm_model)
# stepAIC
steps <- stepAIC(lgm_model, trace = T)
steps
steps <- step(lgm_model)
summary(steps)
# leaps
regsubs <- regsubsets(AHD ~ Age + RestBP + Chol + MaxHR + Oldpeak,
data = data_train,
nbest = 1,
method = "exhaustive")
regsubs
summary(regsubs)
# bestglm
plot_list$AHD <- data_train$AHD
# wald test
wald.test(b = coef(lgm_model), Sigma = vcov(lgm_model), Terms = 2:4)
# goodness-of-fit test
with(lgm_model,
pchisq(null.deviance - deviance,
df.null - df.residual,
lower.tail = F))
# evaluation of model according to cutoff value ====
probs <- predict(lgm_model, data_train, type = "response")
rocplot(probs, data_train$AHD)
cutoff_acc(probs, data_train$AHD)
cutoff_roc(probs, data_train$AHD)
# conf matrix test
db <- unname(cutoff_acc(probs, data_train$AHD)[2,1])
p_tr_probs = predict(lgm_model, data_train, type = "response")
head(p_tr_probs)
head(data_train)
cfi_tr <- confmatrix(p_tr_probs, data_train$AHD, db)
cfi_tr$mtrx
cfi_tr$info
p_te_probs = predict(lgm_model, data_test, type = "response")
head(p_te_probs)
head(data_train)
cfi_te <- confmatrix(p_te_probs, data_test$AHD, db)
cfi_te$mtrx
cfi_te$info
# plots about the data ====
# cont type variables in train dataset
plot_list = list(
Age = data_train$Age,
RestBP = data_train$RestBP,
Chol = data_train$Chol,
MaxHR = data_train$MaxHR,
Oldpeak = data_train$Oldpeak
)
# plotting individually
par(mfrow = c(2,3))
sapply(plot_list, plot, y=data_train$AHD)
# plotting individually
par(mfrow = c(2,3))
sapply(plot_list, plot, y=data_train$AHD)
par(mfrow = c(1,1))
#another graph
logi.hist.plot(probs, data_train$AHD, boxp = F, type = "count", col = "gray", xlabel = "Age")
# all cont type variables
pairs(AHD ~ Age + RestBP + Chol + MaxHR + Oldpeak,
data = data_train,
diag.panel = panel.hist,
lower.panel = panel.cor)
#kfold
trcontrol <- trainControl(method = "cv", number = 10)
trcontrol
train(f.all, data_train, method = 'glm', family = binomial, trcontrol = trcontrol)
train(f_0, data_train, method = 'glm', family = binomial, trcontrol = trcontrol)
cv_model <- cv.glm(data_train, lgm_model)
cv_model$delta
cv_model <- cv.glm(data_train, lgm_model, K = 10)
cv_model$delta
flds <- createFolds(data_train, k = 10, list = TRUE, returnTrain = FALSE)
flds
globalenv()
globalenv(lgm_model)
environment(lgm_model)
environment(exists(lgm_model))
environment()
exists(lgm_model, where = globalenv())
exists(lgm_model, where = globalenv
)
exists("lgm_model")
stop()
stop("Variables in environment are missing.")
stop("Variables in environment are missing.")
debugSource('~/Documents/GitHub/ds510-project2/Scripts/svm-codes.R')
stop("Variables in environment are missing.")
source("Scripts/svm-codes.R")
!exists(vars)
# for simplicity, we will check env if the variables we need are loaded. Otherwise, load first.
vars = c("data_raw", "data_train", "data_test")
if (!exists(vars)) {
stop("Variables in environment are missing.")
}
# svm model ====
svm_model <- svm(f_0, data = data_train, kernel = "linear", cost = 1, scale = F)
summary(svm_model)
# svm model ====
svm_model <- svm(f_0, data = data_train, kernel = "linear", cost = 1, scale = T)
summary(svm_model)
# svm model ====
svm_model <- svm(f_0, data = data_train, kernel = "linear", cost = 1, scale = F)
summary(svm_model)
# svm model ====
svm_model <- svm(f_0, data = data_train, kernel = "radial", cost = 1, scale = F)
summary(svm_model)
print(svm_model)
plot(svm_model)
plot(svm_model, data_train$AHD)
plot(data_train$Age, data_train$AHD)
plot(svm_model, data_train$AHD)
plot(svm_model, data = data_train, AHD ~ Age)
confmatrix(predict(svm_model, data_train$AHD), data_train$AHD, 0.5)
confmatrix(predict(svm_model, data_train$AHD), data_train$AHD, 0.5)
predict(svm_model, data_train$AHD)
predict(svm_model, data_train)
summary(svm_model)
for(fn in methods("predict"))
try({
f <- eval(substitute(getAnywhere(fn)$objs[[1]], list(fn = fn)))
cat(fn, ":\n\t", deparse(args(f)), "\n")
}, silent = TRUE)
## IGNORE_RDIFF_END
predict.svm(svm_model, data_train), data_train$AHD, 0.5)
predict.svm(svm_model, data_train)
predict(svm_model, data_train)
data_train$AHD
head(data_raw)
head(data_train)
f_0
predict(svm_model, data_train)
predict(svm_model, data_train$AHD)
# variable analysis
plot(data_train$Age, data_train$RestBP, col = data_train$AHD)
scatterplot3d::scatterplot3d(data_train$Age, data_train$RestBP, data_train$Chol)
scatterplot3d::scatterplot3d(data_train$Age, data_train$RestBP, data_train$Chol, col = data_train$AHD)
scatterplot3d::scatterplot3d(data_train$Age, data_train$RestBP, data_train$Chol, colvar = data_train$AHD)
scatterplot3d::scatterplot3d(data_train$Age, data_train$RestBP, data_train$Chol, colvar = col = ramp.col(c("blue", "yellow", "red")))
scatterplot3d::scatterplot3d(data_train$Age, data_train$RestBP, data_train$Chol, col = ramp.col(c("blue", "yellow", "red")))
scatterplot3d::scatterplot3d(data_train$Age, data_train$RestBP, data_train$Chol, colvar = NULL)
scatterplot3d::scatterplot3d(data_train$Age, data_train$RestBP, data_train$AHD, colvar = NULL)
scatterplot3d::scatterplot3d(data_train$Age, data_train$AHD, data_train$RestBP, colvar = NULL)
scatterplot3d::scatterplot3d(data_train$Age, data_train$AHD, data_train$RestBP)
scatterplot3d::scatterplot3d(data_train$Age, data_train$AHD, data_train$RestBP,
heta = 15, phi = 20)
scatterplot3d::scatterplot3d(data_train$Age, data_train$AHD, data_train$RestBP,
theta = 15, phi = 20)
scatterplot3d::scatterplot3d(data_train$Age, data_train$AHD, data_train$RestBP,
theta = 15, phi = 20)
scatterplot3d::scatterplot3d(data_train$Age, data_train$AHD, data_train$RestBP,
theta = 15, phi = 20,  bty ="g")
scatterplot3d::scatterplot3d(data_train$Age, data_train$AHD, data_train$RestBP,
theta = 10, phi = 5,  bty ="g")
scatterplot3d::scatterplot3d(data_train$Age, data_train$AHD, data_train$RestBP,
theta = 10, phi = 5,  bty ="g")
scatterplot3d::scatterplot3d(data_train$Age, data_train$AHD, data_train$RestBP,
theta = 10, phi = 5,  bty ="g")
scatterplot3d::scatterplot3d(data_train$Age, data_train$AHD, data_train$RestBP)
# variable analysis
plot(data_train$Age, data_train$RestBP, col = data_train$AHD)
# variable analysis
plot(data_train$Age, col = data_train$AHD)
# variable analysis
plot(data_train$Age, data_train$AHD)
# variable analysis
plot(data_train$RestBP, data_train$Age, data_train$AHD)
# variable analysis
plot(data_train$Age, data_train$AHD)
predict(svm_model, data_train$AHD)
predict(svm_model, data_train)
unique(iris$Species)
svm_model <- svm(Species ~ Sepal.Length + Sepal.Width + Petal.Length + Petal.Width, data = iris)
svm_model
summary(svm_model)
svm_model$SV
pred <- predict(svm_model, iris[,1:4])
predict(svm_model, data_train[,-15])
# svm model ====
svm_model <- svm(f_0, data = data_train, kernel = "radial", cost = 1, scale = F)
summary(svm_model)
predict(svm_model, data_train[,-15])
head(data_train[,-15])
head(data_train[,1:14])
head(data_train[,1:15])
predict(svm_model, data_train[,c(2, 5, 6, 9, 11)])
svm_model <- svm(Species ~ Sepal.Length + Sepal.Width + Petal.Length + Petal.Width, data = iris)
svm_model
summary(svm_model)
svm_model$SV
pred <- predict(svm_model, iris[,1:4])
pred
iris$Species <- ifelse(iris$Species == "setosa", 1, ifelse(iris$Species == "versicolor", 2, 3))
unique(iris$Species)
svm_model <- svm(Species ~ Sepal.Length + Sepal.Width + Petal.Length + Petal.Width, data = iris)
svm_model
summary(svm_model)
svm_model$SV
pred <- predict(svm_model, iris[,1:4])
pred
svm_model <- svm(Species ~ Sepal.Length + Sepal.Width + Petal.Length + Petal.Width, data = iris, type="C-classification")
svm_model
summary(svm_model)
svm_model$SV
pred <- predict(svm_model, iris[,1:4])
pred
# Data Examining ====
# examining variables
str(data_raw)
data_raw$AHD = as.factor(data_raw$AHD)
# correlation of cont variables
cor(data.frame(cont_list))
cor(data_raw$AHD, data.frame(cont_list))
lgm_model = glm(f_3, data = data_train, family = binomial)
summary(lgm_model)
# odds ratio
cbind(exp(confint(lgm_model)), Ods_Ratio = exp(coef(lgm_model)), Coef = coef(lgm_model))
# Anova
anova(lgm_model)
# stepAIC
steps <- stepAIC(lgm_model, trace = T)
steps
summary(steps)
steps <- step(lgm_model)
summary(steps)
# leaps
regsubs <- regsubsets(AHD ~ Age + RestBP + Chol + MaxHR + Oldpeak,
data = data_train,
nbest = 1,
method = "exhaustive")
# evaluation of model according to cutoff value ====
probs <- predict(lgm_model, data_train, type = "response")
rocplot(probs, data_train$AHD)
cutoff_acc(probs, data_train$AHD)
cutoff_roc(probs, data_train$AHD)
# conf matrix test
db <- unname(cutoff_acc(probs, data_train$AHD)[2,1])
p_tr_probs = predict(lgm_model, data_train, type = "response")
head(p_tr_probs)
head(data_train)
cfi_tr <- confmatrix(p_tr_probs, data_train$AHD, db)
rd <- 4
cfi_tr$mtrx
cfi_tr$info
#another graph
logi.hist.plot(probs, data_train$AHD, boxp = F, type = "count", col = "gray", xlabel = "Age")
# svm model ====
svm_model <- svm(f_0, data = data_train, kernel = "radial", cost = 1, scale = F)
summary(svm_model)
plot(svm_model, data = data_train, AHD ~ Age)
predict(svm_model, data_train[,c(2, 5, 6, 9, 11)])
data_train = data_raw[ind == 1, ]
data_test = data_raw[ind == 2, ]
ind = sample(x = 2, size = nrow(data_raw), replace = T, prob = c(0.75, 0.2))
data_train = data_raw[ind == 1, ]
data_test = data_raw[ind == 2, ]
# train and test datasets
data_train = data_raw[ 1:250, ]
data_test = data_raw[251:303, ]
# svm model ====
svm_model <- svm(f_0, data = data_train, kernel = "radial", cost = 1, scale = F)
summary(svm_model)
plot(svm_model, data = data_train, AHD ~ Age)
predict(svm_model, data_train[,c(2, 5, 6, 9, 11)])
predict(svm_model, data_train[,-15])
data_train[,c(2, 5, 6, 9, 11)]
cfi <- confmatrix(preds, data_train$AHD)
# variable analysis
plot(data_train)
# variable analysis
plot(data_train$Age, data_train$RestBP, data_train$Chol, data_train$MaxHR, data_train$AHD)
# variable analysis
plot(data_train$Age, data_train$RestBP, data_train$Chol, data_train$MaxHR, y = data_train$AHD)
# variable analysis
plot(data_train$Age, y = data_train$AHD)
